<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>JS notes</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/notes.css"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">
  </head>
  <body class="node-body node-background">
    <h1 class="font0">Pagina de Javascript</h1>
    <!-- start HEADER -->
    <header id="header" class="node-background">
      <!-- start SEARCH BAR -->
      <a id="btn-open-menu"><i class="fas fa-bars search-icon menu"></i></a>
      <form action='javascript:void()' class='search-form' onSubmit='findString(this.search.value)'>
        <button class="submitBtn"  type="reset" ><i id="xbtn"class="fas fa-times search-icon" ></i></button>
        <input class="txtSearch" type=text name=search placeholder="Pesquisar" size=20 autocomplete="off">
        <button class="submitBtn"><i id="btnlupa"class="fas fa-search search-icon"></i></button>
      </form>
      <!-- end SEARCH BAR -->
      <!-- start MENU SLIDE -->
      <div id="menuDiv" class="menuDiv">
        <nav class="menu-slide">
            <h1 class="font0">Menu de navegação</h1>
            <ul>
              <li><a href="../index.html">Notas</a></li>
              <li><a href="html-notes.html">Html</a></li>
              <li><a href="css-notes.html">Css</a></li>
              <li><a href="js-notes.html">JavaScript</a></li>
              <li><a href="node-notes.html">Node JS</a></li>
              <li><a href="linux-notes.html">Linux</a></li>
              <li><a href="database-notes.html">Banco de dados</a></li>
            </ul> 
        </nav>
      </div>
      <!-- end MENU SLIDE -->
    </header>
    <!--end HEADER --> 
    <div class="conteiner">
      <main>
        <h1 class="title">NodeJS</h1>
      </main>
      <div class="contentDiv">
        <h2>Atualizando o Node (Linux)</h2>
        <h3># Desinstalando a versão antiga</h3>
        <div class="codeDiv">
          <p>sudo apt purge --auto-remove nodejs -y</p>
          <p>sudo rm /etc/apt/sources.list.d/nodesource.list*</p>
        </div>
        <h3>Instalando nova versão</h3>
        <div class="codeDiv">
          <p>Escolha a versão que deseja instalar e siga as instruções para sua distro</p>
          <p><a 
            class="atribute"
            href="https://github.com/nodesource/distributions"
            target="_blank">
              github.com/nodesource
            </a>
          </p>
        </div>
      </div>
      <div class="contentDiv">
        <h2>NPM</h2>
        <p>Npm significa Node Package Manager (Gerenciador de pacotes do Node), 
          é um repositório online para publicação de projetos de código aberto para NodeJs,
          e é um utilitário de linha de comando que interage com este repositorio online,
          e ajuda na instalação de pacotes, gerenciamento de versão e gerenciamento de 
          dependências.
        </p>
        <table class="table-material">
          <thead>
            <tr>
              <th>Comando</th>
              <th>Descrição</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>init</td>
              <td>iniciar o npm em seu diretorio que foi executado.</td>
            </tr>
            <tr>
              <td>install</td>
              <td>instalar dependência</td>
            </tr>
            <tr>
              <td>uninstall</td>
              <td>desinstalar dependências</td>
            </tr>
            <tr>
              <td>run</td>
              <td>Rodar script criado no package.json</td>
            </tr>
              <tr>
              <td>ls --depth=0</td>
              <td>ver todas as dependências que você instalou</td>
            </tr>
            <tr>
              <td>outdated</td>
              <td>ver quais pacotes seus estão desatualizados</td>
            </tr>
          </tbody>
          
        </table>
      </div>

      <div class="contentDiv">
        <h2>Event-loop</h2>
        <p>O Event-loop é um mecanismo interno que utiliza internamente as bibliotecas:</p>
        <p>
          <a class="atribute" target="_blank" href="http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod">libev</a>
           e <a class="atribute" target="_blank" href="http://software.schmorp.de/pkg/libeio.html">libeio</a> 
          que são nativas da linguagem C e responsáveis por prover a funcionalidade de assíncrono
          I/O para o Node.js
          </p>

        <h3>Como o Event-loop funciona? </h3>
        <img src="../../assets/event-loop.png" alt=""/>
        <p>Quando um determinado código emite um evento, ele é enviado para a fila de enventos
          para que o Event-loop execute-o, e em seguida retorne seu resultado em um callback.
          Tal Callback é executado através de um função de escuta, ou mais conhecida como funções 
          de listen  (on, listen etc).
        </p>

        <p>Basicamente ele é um loop infinito, que em cada iteração verifica se existem
          novos eventos em sua fila de eventos.
        </p>

        <p>O EventEmitter é o módulo responsável por emitir eventos, e a maioria das bibliotecas
          do Node herdam desse módulo suas funcionalidades de emit e listen.
        </p>
      </div>

      <div class="contentDiv">
        <h2>Express</h2>
        <p>É um micro framework projetado para criar aplicativos web e APIs.</p>
        <h3>Rotas</h3>
        <p>A definição de rotas segue a seguinte estrutura:</p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">method</span>( <span class="jsstringcolor">Path</span>,
            Handler );
          </p>
        </div>
        <p>Onde:</p>
        <ul class="list-style">
          <li><strong>app</strong> é a const em que o express foi instanciado.</li>
          <li><strong>method</strong> é um HTTP request method (como get post put delete...)</li>
          <li><strong>Path</strong> é caminho do servidor ou a rota da sua aplicação</li>
          <li>
            <strong>Handler</strong> é uma função que é executada quando sua aplicação cai na rota que 
            você passou no path.
          </li>
        </ul>
        <p>Um exemplo simples e prático:</p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/'</span>,
            ( ) <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            <span class="jsstringcolor">'Hello World'</span> )
          </p>
          <p>});</p>
          <p class="jscommentcolor">
            // quando o usuario acessar seu site na rota principal uma 
            mensagem de 'Hello World' será retornada
          </p>
          </div>
          <h4>Métodos de roteamento</h4>
          <p>
            Um método de roteamento é derivado a partir de um dos métodos HTTP,
            e é anexado a uma instancia da classe express.
          </p>
          <div class="dark-codeDiv">
            <p class="jscommentcolor">// Rota com método GET </p>
            <p>
              app.<span class="jsvarcolor">get</span>(
              <span class="jsstringcolor">'/'</span>, (
              <span class="jsparametercolor">req, res</span> )
              <span class="jskeywordcolor">=></span> {
            </p>
            <p class="margintab">
              res.<span class="jsvarcolor">send</span>(
              <span class="jsstringcolor">'Get request to the homepage'</span>
              )
            </p>
            <p>});</p>
            <p class="jscommentcolor">// Rota com método POST </p>
            <p>
              app.<span class="jsvarcolor">post</span>(
              <span class="jsstringcolor">'/'</span>, (
              <span class="jsparametercolor">req, res</span> )
              <span class="jskeywordcolor">=></span> {
            </p>
            <p class="margintab">
              res.<span class="jsvarcolor">send</span>(
              <span class="jsstringcolor">'POST request to the homepage'</span>
              )
            </p>
            <p>});</p>
        </div>
        <p>
          Existe um método de roteamento especial, app.all( ), que não é 
          derivado de nenhum método HTTP, este método é usado para carregar
          funções de 
          <a
          class="link"
          target="_blank" 
          href="https://expressjs.com/pt-br/guide/using-middleware.html">
          middleware
          </a>
          em um caminho para todos os métodos de solicitação.
        </p>
        <h4>Caminhos de rota</h4>
        <p>
          Caminhos de rotas podem ser sequências de caracteres, padrões de sequências
          ou expressões regulares.
        </p>
        <p>
          Aqui estão alguns exemplos de caminhos de rota baseados em sequeências de 
          caracteres:
        </p>
        <div class="dark-codeDiv">
          <p class="jscommentcolor">// corresponde ao caminho '/about'</p>
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/about'</span>, (
            <span class="jsparametercolor">req, res</span>)
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            <span class="jsstringcolor">'about'</span>)
          </p>
          <p>});</p>

          <p class="jscommentcolor">// corresponde ao caminho '/pages'</p>
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/about'</span>, (
            <span class="jsparametercolor">req, res</span>)
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            <span class="jsstringcolor">'pages'</span>)
          </p>
          <p>});</p>
        </div>
        <p>Exemplo de caminhos de rotas baseados em expressões regulares:</p>
        <div class="dark-codeDiv">
          <p class="jscommentcolor">
            // este caminho irá corresponder a qualquer coisa com um "a" no nome
          </p>
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">/a/</span>, (
            <span class="jsparametercolor">req, res</span>)
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            <span class="jsstringcolor">'/a/'</span>)
          </p>
          <p>});</p>
          <p class="jscommentcolor">
              // este caminho irá corresponder a qualquer coisa que termine com fly
            </p>
            <p>
              app.<span class="jsvarcolor">get</span>(
              <span class="jsstringcolor">/.*fly$/</span>, (
              <span class="jsparametercolor">req, res</span>)
              <span class="jskeywordcolor">=></span> {
            </p>
            <p class="margintab">
              res.<span class="jsvarcolor">send</span>(
              <span class="jsstringcolor">'/.*fly$/'</span>)
            </p>
            <p>});</p>
        </div>
        <h4>Métodos de resposta</h4>
        <p>
          Os métodos do objeto de resposta (res) na seguinte tabela podem enviar uma 
          resposta ao cliente, e finalizar o ciclo de solicitação-resposta.
        </p>
        <table class="table-material">
          <thead>
            <tr>
              <th>Método</th>
              <th>Descrição</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>res.download()</td>
              <td>Solicita que seja efetuado o download de um arquivo</td>
            </tr>
            <tr>
              <td>res.end()</td>
              <td>Termina o processo de resposta.</td>
            </tr>   
            <tr>
              <td>res.json()</td>
              <td>Envia uma resposta JSON.</td>
            </tr>         
            <tr>
              <td>res.jsonp()</td>
              <td>Envia uma resposta JSON com suporta ao JSONP.</td>
            </tr>
            <tr>
              <td>res.redirect()</td>
              <td>Redireciona uma solicitação.</td>
            </tr>
            <tr>
              <td>res.render()</td>
              <td>Renderiza um modelo de visualização.</td>
            </tr>
            <tr>
              <td>res.send()</td>
              <td>Envia uma resposta de vários tipos.</td>
            </tr>
            <tr>
              <td>res.sendFile</td>
              <td>Envia um arquivo como um fluxo de octeto.</td>
            </tr>
            <tr>
              <td>res.sendStatus()</td>
              <td>
                Configura o código do status de resposta e envia a sua representação
                em sequência de caracteres como o corpo de resposta.
              </td>
            </tr>
          </tbody>
        </table>
        <h4>Parâmetros e Queries na rota</h4>
        <p>Exemplo de Rota com Url param:</p>
        <div class="codeDiv">
        <p>http://facebook.com/profiles/<span class="green">174652</span></p> 
        <p class="jscommentcolor">
          O 174652 no exemplo é da conta do usuario que está acessando o
          facebook, e é um parâmetro de rota
        </p>
        </div>
        <p>Agora veja o mesmo exemplo com Query string:</p>
        <div class="codeDiv">
          <p>
            http://facebook.com/profiles/174652/<span class="green">?campanha=googleads</span>
          </p>
        </div>
        <ul class="list-style">
          <li><span class="green">?</span> sinaliza que você está iniciando uma query string</li>
          <li><span class="green">campanha</span> é a chave de sua query string</li>
          <li><span class="green">googleads</span> é o valor</li>
        </ul>
        <p>
          Você também pode adicionar vários paramêtros em query string usando entre eles um
          <span class="green">&</span> Ex:
        </p>
        <div class="codeDiv">
          <p>
            .../profiles/<span class="green">?campanha=googleads & param2=value2 & param3=value3</span>
          </p>
          <p class="jscommentcolor">espaços usados apenas para melhor visualização do &</p>
        </div>
        <div class="alertDiv">
          <p>
            Se você não informar ao express que sua rota vai receber um parâmetro o uso dele
            não vai ser posível.
          </p>
        </div>
        <p>Para dizer que sua rota vai receber um parâmetro:</p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/testes/:user_id'</span>, ( )
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">...restante do código aqui</p>
          <p>});</p>
          <p class="jscommentcolor">
            // usando o '/:' você indica que a rota vai receber um parametro
          </p>
          <p class="jscommentcolor">
            // o que vier depois do /:, nesse caso user_id vai ser a chave referente ao valor
            que você enviar como parâmetro na url
          </p>
        </div>
        <p>
          Dessa maneira se você tentar acessar /testes SEM PASSAR um parâmetro
          não vai funcionar.
        </p>
        <p>Para poder tornar o parâmetro opcional adicione <span class="green">?</span> como no ex:</p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/testes/:user_id?'</span>, ( )
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">...restante do código aqui</p>
          <p>});</p>
        </div>
        <h4>Enviando parâmetros no corpo da requisição</h4>
        <p>
          No exemplo abaixo temos um formulário com method post sendo enviado
          para a rota raiz do site:
        </p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/'</span> ( )
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
          </p>
          <p class="margintabX2 jsstringcolor">
            `&ltform action="/" method="POST"&gt
          </p>
          <p class="margintabX2 jsstringcolor">&ltinput type="text" name="nome"&gt</p>
          <p class="margintabX2 jsstringcolor">&ltbutton>Enviar&lt/button&gt</p> 
          <p class="margintabX2 jsstringcolor">&lt/form&gt`</p>
          <p class="margintab">)</p>
          <p>});</p>

          <p>
            app.<span class="jsvarcolor">post</span>(
            <span class="jsstringcolor">'/'</span>, (<span class="jsparametercolor">req, res</span>)
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            <span class="jscyancolor">console.log</span>(req.body);
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            `<span class="jsstringcolor">O que você me enviou foi </span>
            <span class="jskeywordcolor">${
            <span class="jsdefaultcolor">req.body.nome </span>}</span>`);
            <span class="jscommentcolor">//esse nome é o name do input do form</span>
          </p>
          <p>});</p>

          <p class="jscommentcolor">// O que você escrever no input será enviado no body da requisição e não na url</p>
        </div>
        <p>
          Para enviar esses parâmetros no corpo da requisição você tem que informar ao express com 
          a linha de código abaixo:
        </p>
        <div class="dark-codeDiv">
          <p>
            app.<span class="jsvarcolor">use</span>(
            express.<span class="jsvarcolor">urlencoded</span>
            ({ extended<span class="jskeywordcolor">:</span>
            <span class="jsnumbercolor">true</span> }) );
          </p>
        </div>
        <h4>express.Router</h4>
        <p>
          A classe express.Router é usada para criar manipuladores de rota modulares,
          com ele você pode separar as rotas da sua aplicação em um arquivo especifico.
        </p>
        <div class="dark-codeDiv">
          <p class="jscommentcolor">// routes.js</p>
          <p>
            <span class="jskeywordcolor">const</span> routes
            <span class="jskeywordcolor">=</span>
            express.<span class="jsvarcolor">Router</span>( );
          </p>
          <p>
            <span class="jskeywordcolor">const</span> homeController
            <span class="jskeywordcolor">=</span>
            <span class="jscyancolor">require</span>(
              <span class="jsstringcolor">'./Controllers/homeController'</span> )
          </p>
          <p>
            router.<span class="jsvarcolor">get</span>(
            <span class="jsstringcolor">'/'</span>, homeController.homePage );
          </p>
          <p>
            <span class="jscyancolor">module.exports</span>
            <span class="jskeywordcolor">=</span> routes;
          </p>
        </div>
        <p>
          O routes.js vai ser responsável somente por importar os Controllers e 
          direcionar eles para a rota desejada (por exemplo: homeController na rota '/').
        </p>
        <p>
          Agora veremos o papel dos Controllers nas rotas, que serão responsaveis 
          basicamente pelas funções de retorno ou de envio para cada rota, veremos uma 
          explicação mais detalhada sobre controllers no tópico de MVC.
        </p>
        <div class="dark-codeDiv">
          <p>
            <span class="jscyancolor">module.exports</span>.homePage 
            <span class="jskeywordcolor">=</span> (
            <span class="jsparametercolor">req, res</span> )
            <span class="jskeywordcolor">=></span> {
          </p>
          <p class="margintab">
            res.<span class="jsvarcolor">send</span>(
            <span class="jsstringcolor">'Você está na página principal'</span> )
          </p>
          <p>};</p>
        </div>
        <p>
          E para que toda essa organização de rotas funcionar, precisamos informar
          ao express com o seguinte código no arquivo server.js:
        </p>
        <div class="dark-codeDiv">
          <p>
            <span class="jskeywordcolor">const</span> routes
            <span class="jskeywordcolor">=</span>
            <span class="jscyancolor">require</span>(
            <span class="jsstringcolor">'./routes.js'</span> );
          </p>
          <p>app.<span class="jsvarcolor">use</span>(routes);</p>
        </div>
        <h3>Views</h3>
        <p>crie uma pasta "Views" dentro de src para armazenar os arquivos.</p>
        <p>
          Para a utilização de views funcionar você precisa informar ao express Onde
          está a view e qual view engine você vai usar:
        </p>
        <div class="dark-codeDiv">
          <p class="jscommentcolor">// informando caminho da View</p>
          <p>
            app.<span class="jsvarcolor">set</span>(
            <span class="jsstringcolor">'views'</span>,
            <span class="jsstringcolor">'./src/Views'</span>)
          </p>

          <p class="jscommentcolor">// informando View-engine</p>
          <p>
            app.<span class="jsvarcolor">set</span>(
            <span class="jsstringcolor">'view engine'</span>,
            <span class="jsstringcolor">'ejs'</span> );
          </p>
        </div>
        <h3>Conteúdo estático</h3>
        <p>
          Na raiz de seu Projeto (ou seja, fora de src) crie uma pasta <span class="blue">public</span>,
          a pasta será usada para qualquer conteudo estático de sua aplicação, como css, bundle.js etc.
        </p>
        <p>
          Depois de criar a pasta informe ao express que você deseja usar ela para conteúdo estático:
        </p>
        <div class="dark-codeDiv">
          <p class="jscommentcolor">// server.js</p>
          <p>
            app.<span class="jsvarcolor">use</span>(
            express.<span class="jsvarcolor">static</span>(
            <span class="jsstringcolor">'./public'</span> ));
          </p>
        </div>
      </div>



    </div> <!-- end container div-->
    <script src="../script/script.js"></script>
    <script src="../script/nodejspage.js"></script>
    <script src="https://kit.fontawesome.com/c5cfd6950a.js"></script>
  </body>